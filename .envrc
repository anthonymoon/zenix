#!/usr/bin/env bash
# direnv configuration for Zenix development environment

# Enable direnv stdlib
source_up_if_exists

# Use flake-based development shell
if command -v nix &> /dev/null; then
  if [[ -f flake.nix ]]; then
    echo "Loading Zenix development environment..."
    use flake . --impure
  else
    echo "Error: flake.nix not found"
    exit 1
  fi
else
  echo "Error: Nix is not installed. Please install Nix first."
  echo "Visit: https://nixos.org/download.html"
  exit 1
fi

# Set up pre-commit hooks if not already installed
if [[ ! -f .git/hooks/pre-commit ]]; then
  echo "Setting up pre-commit hooks..."
  if command -v pre-commit &> /dev/null; then
    pre-commit install
  fi
fi

# Export development environment variables
export NIXPKGS_ALLOW_UNFREE=1
export NIX_SHELL_PRESERVE_PROMPT=1

# Custom aliases for development
alias nf="nix fmt"
alias nc="nix flake check --impure"
alias nb="nixos-rebuild build --flake ."
alias nv="nix flake show"
alias nu="nix flake update"

# Development tips
echo ""
echo "ðŸš€ Zenix Development Environment Loaded!"
echo ""
echo "Available commands:"
echo "  nf  - Format all Nix files"
echo "  nc  - Check flake configuration" 
echo "  nb  - Build NixOS configuration"
echo "  nv  - Show flake outputs"
echo "  nu  - Update flake inputs"
echo ""
echo "Pre-commit hooks:"
echo "  pre-commit run --all-files  - Run all hooks manually"
echo "  pre-commit run alejandra    - Run only alejandra"
echo "  pre-commit run nixfmt       - Run only nixfmt"
echo ""